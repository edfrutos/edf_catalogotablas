<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug Modal Dashboard</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">
    
    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
    <div class="container mt-5">
        <h2>Debug Modal Dashboard</h2>
        
        <div class="alert alert-info">
            <h5>Instrucciones:</h5>
            <ol>
                <li>Abre las herramientas de desarrollador (F12)</li>
                <li>Ve a la pesta√±a "Console"</li>
                <li>Haz click en el bot√≥n "Google Drive"</li>
                <li>Observa los mensajes en la consola</li>
            </ol>
        </div>
        
        <!-- Bot√≥n exactamente igual al del dashboard -->
        <button 
            class="btn btn-outline-success ms-2" 
            id="restoreDriveBtn"
            data-bs-toggle="modal" 
            data-bs-target="#restoreDriveModal"
        >
            <i class="bi bi-google"></i> Google Drive
        </button>
        
        <div class="mt-3">
            <h5>Tests de diagn√≥stico:</h5>
            <button onclick="runDiagnostics()" class="btn btn-primary">Ejecutar Diagn√≥sticos</button>
            <button onclick="forceOpenModal()" class="btn btn-warning">Forzar Abrir Modal</button>
        </div>
        
        <div id="diagnostics" class="mt-3"></div>
    </div>

    <!-- Modal exactamente igual al del dashboard -->
    <div class="modal fade" id="restoreDriveModal" tabindex="-1" aria-labelledby="restoreDriveModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="restoreDriveModalLabel">
                        <i class="bi bi-google"></i> Restaurar desde Google Drive
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="text-center py-4">
                        <h6>Modal funcionando correctamente</h6>
                        <p>Si ves este mensaje, Bootstrap est√° funcionando.</p>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        $(document).ready(function() {
            console.log("=== INICIO DEBUG MODAL ===");
            console.log("‚úÖ jQuery cargado:", typeof $ !== 'undefined');
            console.log("‚úÖ Bootstrap cargado:", typeof bootstrap !== 'undefined');
            console.log("‚úÖ Bootstrap.Modal disponible:", typeof bootstrap !== 'undefined' && typeof bootstrap.Modal !== 'undefined');
            
            // Eventos del modal para debug
            $("#restoreDriveModal").on("show.bs.modal", function() {
                console.log("üîµ [EVENT] show.bs.modal - Modal va a abrirse");
            });
            
            $("#restoreDriveModal").on("shown.bs.modal", function() {
                console.log("‚úÖ [EVENT] shown.bs.modal - Modal abierto exitosamente");
            });
            
            $("#restoreDriveModal").on("hide.bs.modal", function() {
                console.log("üîµ [EVENT] hide.bs.modal - Modal va a cerrarse");
            });
            
            $("#restoreDriveModal").on("hidden.bs.modal", function() {
                console.log("‚úÖ [EVENT] hidden.bs.modal - Modal cerrado");
            });
            
            // Evento del bot√≥n para debug
            $("#restoreDriveBtn").on("click", function() {
                console.log("üîç [CLICK] Bot√≥n Google Drive clickeado");
                console.log("  - data-bs-toggle:", this.getAttribute('data-bs-toggle'));
                console.log("  - data-bs-target:", this.getAttribute('data-bs-target'));
            });
        });
        
        function runDiagnostics() {
            console.log("=== EJECUTANDO DIAGN√ìSTICOS ===");
            
            const checks = {
                'jQuery cargado': typeof $ !== 'undefined',
                'Bootstrap cargado': typeof bootstrap !== 'undefined',
                'Bootstrap.Modal disponible': typeof bootstrap !== 'undefined' && typeof bootstrap.Modal !== 'undefined',
                'Modal element existe': document.getElementById('restoreDriveModal') !== null,
                'Bot√≥n existe': document.getElementById('restoreDriveBtn') !== null,
                'Bot√≥n tiene data-bs-toggle': document.getElementById('restoreDriveBtn')?.getAttribute('data-bs-toggle') === 'modal',
                'Bot√≥n tiene data-bs-target': document.getElementById('restoreDriveBtn')?.getAttribute('data-bs-target') === '#restoreDriveModal',
                'Modal tiene clases correctas': document.getElementById('restoreDriveModal')?.classList.contains('modal'),
                'Modal tiene fade': document.getElementById('restoreDriveModal')?.classList.contains('fade')
            };
            
            let html = '<div class="alert alert-info"><h6>Diagn√≥sticos:</h6><ul class="mb-0">';
            for (const [check, result] of Object.entries(checks)) {
                const icon = result ? '‚úÖ' : '‚ùå';
                const color = result ? 'text-success' : 'text-danger';
                html += `<li class="${color}">${icon} ${check}: <strong>${result}</strong></li>`;
                console.log(`${icon} ${check}: ${result}`);
            }
            html += '</ul></div>';
            
            $("#diagnostics").html(html);
        }
        
        function forceOpenModal() {
            console.log("=== FORZANDO APERTURA MANUAL ===");
            try {
                const modalElement = document.getElementById('restoreDriveModal');
                const modal = new bootstrap.Modal(modalElement);
                modal.show();
                console.log("‚úÖ Modal forzado abierto");
            } catch (error) {
                console.error("‚ùå Error forzando modal:", error);
            }
        }
    </script>
</body>
</html>
