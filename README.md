# Cat√°logo de Tablas #

Aplicaci√≥n Flask para la gesti√≥n de cat√°logos de tablas con autenticaci√≥n, gesti√≥n de usuarios y almacenamiento en MongoDB.

## üöÄ Caracter√≠sticas Principales ##

- **Gesti√≥n de Usuarios**: Sistema de autenticaci√≥n con roles (admin/user)
- **CRUD de Cat√°logos**: Creaci√≥n, lectura, actualizaci√≥n y eliminaci√≥n de cat√°logos
- **Importaci√≥n/Exportaci√≥n**: Soporte para Excel y CSV
- **Almacenamiento**: Im√°genes en sistema de archivos local o S3
- **Monitoreo**: Sistema integrado de logging y monitoreo

## üõ†Ô∏è Estructura del Proyecto ##

```
./edf_catalogotablas/
‚îú‚îÄ‚îÄ app/                    # C√≥digo principal de la aplicaci√≥n
‚îÇ   ‚îú‚îÄ‚îÄ routes/             # Rutas de la aplicaci√≥n
‚îÇ   ‚îú‚îÄ‚îÄ static/             # Archivos est√°ticos (CSS, JS, im√°genes)
‚îÇ   ‚îú‚îÄ‚îÄ templates/          # Plantillas HTML
‚îÇ   ‚îî‚îÄ‚îÄ utils/              # Utilidades de la aplicaci√≥n
‚îú‚îÄ‚îÄ config/                 # Archivos de configuraci√≥n
‚îú‚îÄ‚îÄ docs/                   # Documentaci√≥n del proyecto
‚îú‚îÄ‚îÄ models/                 # Modelos de datos
‚îú‚îÄ‚îÄ scripts/                # Scripts de utilidad
‚îÇ   ‚îú‚îÄ‚îÄ db_utils/           # Utilidades de base de datos
‚îÇ   ‚îú‚îÄ‚îÄ hooks/              # Hooks para PyInstaller
‚îÇ   ‚îî‚îÄ‚îÄ maintenance/        # Scripts de mantenimiento
‚îú‚îÄ‚îÄ tests/                  # Pruebas automatizadas
‚îÇ   ‚îú‚îÄ‚îÄ integration/        # Pruebas de integraci√≥n
‚îÇ   ‚îî‚îÄ‚îÄ unit/               # Pruebas unitarias
‚îî‚îÄ‚îÄ tools/                  # Herramientas de desarrollo
```

## üöÄ Instalaci√≥n ##

1. **Clonar el repositorio**

   ```bash
   git clone https://github.com/edfrutos/edf_catalogotablas.git
   cd edf_catalogotablas
   ```

2. **Crear y activar entorno virtual**

   ```bash
   python -m venv .venv
   source .venv/bin/activate  # En Windows: .venv\Scripts\activate
   ```

3. **Instalar dependencias**

   ```bash
   pip install -r requirements.txt
   ```

4. **Configurar variables de entorno**
   Copiar el archivo `.env.example` a `.env` y configurar seg√∫n sea necesario.

5. **Iniciar la aplicaci√≥n**

   ```bash
   python run.py
   ```

   O para producci√≥n:

   ```bash
   gunicorn --bind 0.0.0.0:5000 wsgi:app
   ```

## üì¶ Dependencias Principales ##

- **Backend**: Flask, Flask-Login, Flask-PyMongo
- **Base de datos**: PyMongo
- **Autenticaci√≥n**: bcrypt, Flask-Session
- **Procesamiento de datos**: pandas, openpyxl
- **Despliegue**: gunicorn

## ü§ñ Ejecuci√≥n de Pruebas ##

Para ejecutar las pruebas unitarias:

```bash
pytest tests/unit/
```

---

## üçè Build y Despliegue de la App macOS EDFCatalogoTablas ##

### Build Local Autom√°tico ###

1. Aseg√∫rate de tener Python 3.10+ y [PyInstaller](https://pyinstaller.org/) instalado.
2. Ejecuta el script de build:

   ```bash
   ./build_mac_app.sh
   ```

   Esto generar√° el bundle en `dist/EDFCatalogoTablas.app`.

### Build Autom√°tico en GitHub Actions (CI) ###

- Cada push a `master` lanzar√° un workflow que construye la app en macOS y deja el bundle como artefacto descargable.
- El workflow est√° en `.github/workflows/mac_build.yml`.

### Instrucciones para Usuarios Finales ###

1. Descarga o clona el repositorio.
2. Si solo quieres la app, descarga `EDFCatalogoTablas.app` desde la carpeta `dist/` o desde los artefactos de GitHub Actions.
3. Haz doble clic para ejecutar. Si ves advertencia de seguridad, ve a Preferencias del Sistema ‚Üí Seguridad y permite la app.
4. Para distribuci√≥n profesional, firma la app con tu Apple ID.

---

Para pruebas de integraci√≥n:

```bash
pytest tests/integration/
```

---

## Creaci√≥n y Distribuci√≥n Profesional de una App para macOS ##

Gu√≠a pr√°ctica y detallada para desarrollar, empaquetar, firmar, notarizar y distribuir una aplicaci√≥n profesional para macOS a partir de un proyecto Python (ejemplo: EDFCatalogoTablas).

## Tabla de Contenidos T√©cnica ##

- [Cat√°logo de Tablas](#cat√°logo-de-tablas)
  - [üöÄ Caracter√≠sticas Principales](#-caracter√≠sticas-principales)
  - [üõ†Ô∏è Estructura del Proyecto](#Ô∏è-estructura-del-proyecto)
  - [üöÄ Instalaci√≥n](#-instalaci√≥n)
  - [üì¶ Dependencias Principales](#-dependencias-principales)
  - [ü§ñ Ejecuci√≥n de Pruebas](#-ejecuci√≥n-de-pruebas)
  - [üçè Build y Despliegue de la App macOS EDFCatalogoTablas](#-build-y-despliegue-de-la-app-macos-edfcatalogotablas)
    - [Build Local Autom√°tico](#build-local-autom√°tico)
    - [Build Autom√°tico en GitHub Actions (CI)](#build-autom√°tico-en-github-actions-ci)
    - [Instrucciones para Usuarios Finales](#instrucciones-para-usuarios-finales)
  - [Creaci√≥n y Distribuci√≥n Profesional de una App para macOS](#creaci√≥n-y-distribuci√≥n-profesional-de-una-app-para-macos)
  - [Tabla de Contenidos T√©cnica](#tabla-de-contenidos-t√©cnica)
  - [1. Requisitos Previos](#1-requisitos-previos)
  - [2. Preparaci√≥n del Entorno de Desarrollo](#2-preparaci√≥n-del-entorno-de-desarrollo)
  - [3. Empaquetado de la App (PyInstaller)](#3-empaquetado-de-la-app-pyinstaller)
    - [Recursos Est√°ticos y Plantillas](#recursos-est√°ticos-y-plantillas)
  - [4. Automatizaci√≥n del Build](#4-automatizaci√≥n-del-build)
    - [Script Bash (`build_mac_app.sh`)](#script-bash-build_mac_appsh)
    - [Automatizaci√≥n en CI (GitHub Actions)](#automatizaci√≥n-en-ci-github-actions)
  - [5. Firma de la App](#5-firma-de-la-app)
    - [a) Solicita tu Certificado](#a-solicita-tu-certificado)
    - [b) Firma la App](#b-firma-la-app)
    - [c) Verifica la Firma](#c-verifica-la-firma)
  - [6. Notarizaci√≥n con Apple](#6-notarizaci√≥n-con-apple)
    - [a) Comprime la App](#a-comprime-la-app)
    - [b) Sube a Notarizaci√≥n](#b-sube-a-notarizaci√≥n)
    - [c) Adjunta la Notarizaci√≥n ("staple")](#c-adjunta-la-notarizaci√≥n-staple)
  - [7. Creaci√≥n de un Instalador DMG](#7-creaci√≥n-de-un-instalador-dmg)
  - [8. Distribuci√≥n y Buenas Pr√°cticas](#8-distribuci√≥n-y-buenas-pr√°cticas)
  - [9. Recursos y Enlaces √ötiles](#9-recursos-y-enlaces-√∫tiles)
  - [üìù Gu√≠a de Contribuci√≥n](#-gu√≠a-de-contribuci√≥n)
  - [üìÑ Licencia](#-licencia)
  - [‚ú® Agradecimientos](#-agradecimientos)
- [üîí Gesti√≥n de Archivos Sensibles y Restauraci√≥n](#-gesti√≥n-de-archivos-sensibles-y-restauraci√≥n)
  - [1. Archivos Sensibles Locales](#1-archivos-sensibles-locales)
  - [2. Archivos de Ejemplo](#2-archivos-de-ejemplo)
  - [3. Respaldo y Restauraci√≥n Local](#3-respaldo-y-restauraci√≥n-local)
  - [4. Tabla Resumen](#4-tabla-resumen)
  - [5. Recomendaciones](#5-recomendaciones)
  - [üß≠ C√≥mo Generar y Mantener un √çndice Autom√°tico en Markdown](#-c√≥mo-generar-y-mantener-un-√≠ndice-autom√°tico-en-markdown)

## 1. Requisitos Previos ##

- **Apple ID** y [Apple Developer Program](https://developer.apple.com/programs/) (para firma y notarizaci√≥n)
- **Xcode** y Xcode Command Line Tools (`xcode-select --install`)
- **Python 3.10+**
- **Homebrew** ([instalar](https://brew.sh/))
- **PyInstaller** (`pip install pyinstaller`)
- (Opcional) [create-dmg](https://github.com/create-dmg/create-dmg) para crear DMG instalables

## 2. Preparaci√≥n del Entorno de Desarrollo ##

1. **Clona el repositorio:**

   ```bash
   git clone https://github.com/edfrutos/edf_catalogotablas.git
   cd edf_catalogotablas
   ```

2. **Crea y activa un entorno virtual:**

   ```bash
   python3 -m venv .venv
   source .venv/bin/activate
   ```

3. **Instala las dependencias:**

   ```bash
   pip install -r requirements.txt
   ```

4. **Instala PyInstaller:**

   ```bash
   pip install pyinstaller
   ```

## 3. Empaquetado de la App (PyInstaller) ##

- Aseg√∫rate de tener un archivo `.spec` bien configurado o usa el comando b√°sico:

  ```bash
  pyinstaller --onefile --windowed app.py
  ```

- Para proyectos complejos, usa el archivo `edf_catalogotablas.spec` y ejecuta:

  ```bash
  pyinstaller edf_catalogotablas.spec
  ```

- El resultado estar√° en `dist/EDFCatalogoTablas.app`

### Recursos Est√°ticos y Plantillas ###

- Aseg√∫rate de incluir todos los archivos necesarios (templates, static) en el `.spec` usando `datas=[...]`.
- [Documentaci√≥n oficial PyInstaller](https://pyinstaller.org/en/stable/spec-files.html)

## 4. Automatizaci√≥n del Build ##

### Script Bash (`build_mac_app.sh`) ###

```bash
#!/bin/bash
set -e

echo "Limpiando builds anteriores..."
rm -rf build dist EDFCatalogoTablas.app

echo "Instalando dependencias..."
pip install -r requirements.txt

echo "Ejecutando PyInstaller..."
pyinstaller edf_catalogotablas.spec

echo "Build completado. El bundle est√° en dist/EDFCatalogoTablas.app"
```

### Automatizaci√≥n en CI (GitHub Actions) ###

- `.github/workflows/mac_build.yml`:

```yaml
name: Build macOS App

on:
  push:
    branches: [ master ]

jobs:
  build:
    runs-on: macos-latest
    steps:
      - uses: actions/checkout@v3
      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'
      - name: Install dependencies
        run: pip install -r requirements.txt pyinstaller
      - name: Build App
        run: pyinstaller edf_catalogotablas.spec
      - name: Upload artifact
        uses: actions/upload-artifact@v3
        with:
          name: EDFCatalogoTablas.app
          path: dist/EDFCatalogoTablas.app
```

## 5. Firma de la App ##

### a) Solicita tu Certificado ###

- Desde [Apple Developer Certificates](https://developer.apple.com/account/resources/certificates/list), crea un certificado **Developer ID Application** y a√±√°delo a tu llavero (Keychain Access).

### b) Firma la App ###

```bash
codesign --deep --force --verify --verbose \
  --sign "Developer ID Application: Tu Nombre (XXXXXXXXXX)" \
  dist/EDFCatalogoTablas.app
```

### c) Verifica la Firma ###

```bash
codesign --verify --deep --strict --verbose=2 dist/EDFCatalogoTablas.app
```

- M√°s info: [Apple Code Signing Guide](https://developer.apple.com/documentation/security/notarizing_macos_software_before_distribution)

## 6. Notarizaci√≥n con Apple ##

### a) Comprime la App ###

```bash
cd dist
zip -r EDFCatalogoTablas.zip EDFCatalogoTablas.app
```

### b) Sube a Notarizaci√≥n ###

```bash
xcrun notarytool submit EDFCatalogoTablas.zip \
  --apple-id "tu-email@apple.com" \
  --team-id "XXXXXXXXXX" \
  --password "app-specific-password" \
  --wait
```

- Genera una [contrase√±a espec√≠fica de app](https://support.apple.com/en-us/HT204397).

### c) Adjunta la Notarizaci√≥n ("staple") ###

```bash
xcrun stapler staple EDFCatalogoTablas.app
```

- M√°s info: [Apple Notarization Guide](https://developer.apple.com/documentation/security/notarizing_macos_software_before_distribution)

## 7. Creaci√≥n de un Instalador DMG ##

- Instala `create-dmg`:

  ```bash
  brew install create-dmg
  ```

- Crea el DMG:

  ```bash
  create-dmg dist/EDFCatalogoTablas.app
  ```

- [Gu√≠a create-dmg](https://github.com/create-dmg/create-dmg)

## 8. Distribuci√≥n y Buenas Pr√°cticas ##

- Comparte el `.dmg` o `.zip` firmado y notarizado.
- Incluye el archivo `LICENSE` (MIT, GPL, etc.) en el paquete.
- Proporciona instrucciones para usuarios sobre c√≥mo permitir la app en Preferencias del Sistema si Gatekeeper la bloquea.
- Si distribuyes a gran escala, considera automatizar la subida a tu web o a servicios como AWS S3.

## 9. Recursos y Enlaces √ötiles ##

- [Apple Developer Program](https://developer.apple.com/programs/)
- [Documentaci√≥n oficial notarizaci√≥n](https://developer.apple.com/documentation/security/notarizing_macos_software_before_distribution)
- [PyInstaller Docs](https://pyinstaller.org/en/stable/)
- [create-dmg](https://github.com/create-dmg/create-dmg)
- [Automatizaci√≥n con GitHub Actions](https://docs.github.com/en/actions)
- [Soporte Apple: Contrase√±as espec√≠ficas de app](https://support.apple.com/en-us/HT204397)

---

**Autor:** Eugenio De Frutos S√°nchez ‚Äî 2025  
Licencia: MIT

## üìù Gu√≠a de Contribuci√≥n ##

1. Haz un fork del proyecto
2. Crea una rama para tu caracter√≠stica (`git checkout -b feature/AmazingFeature`)
3. Haz commit de tus cambios (`git commit -m 'Add some AmazingFeature'`)
4. Haz push a la rama (`git push origin feature/AmazingFeature`)
5. Abre un Pull Request

## üìÑ Licencia ##

Este proyecto est√° bajo la Licencia MIT - ver el archivo [LICENSE](LICENSE) para m√°s detalles.

## ‚ú® Agradecimientos ##

- A todos los contribuyentes que han ayudado a mejorar este proyecto.
- A la comunidad de c√≥digo abierto por las herramientas y bibliotecas utilizadas.

---

# üîí Gesti√≥n de Archivos Sensibles y Restauraci√≥n #

Este proyecto **no incluye archivos sensibles ni credenciales reales** en el repositorio por seguridad. Para que la aplicaci√≥n funcione correctamente despu√©s de clonar el proyecto, sigue estos pasos:

## 1. Archivos Sensibles Locales ##

> ‚ö†Ô∏è **Advertencia de seguridad:** Los archivos como `.env`, configuraciones con contrase√±as, tokens, claves API, etc., **NO est√°n en el repositorio**.
> Por seguridad, estos archivos est√°n listados en `.gitignore` y nunca se suben a git.
> Si tienes un backup local (por ejemplo, en `sensitive_backup/`), puedes restaurar f√°cilmente tus archivos sensibles.

## 2. Archivos de Ejemplo ##

- El repositorio incluye archivos de ejemplo como `.env.example` o `config_debug_example.py`.
- Tras clonar, **copia el archivo de ejemplo y ed√≠talo con tus datos reales**:

  ```sh
  cp .env.example .env
  # Edita .env y a√±ade tus credenciales
  cp dev_template/tests/legacy/config_debug_example.py dev_template/tests/legacy/config_debug.py
  # Edita config_debug.py con tus credenciales
  ```

## 3. Respaldo y Restauraci√≥n Local ##

- Puedes usar el script `tools/backup_sensitive_files.sh` para hacer un respaldo local de tus archivos sensibles:

  ```sh
  bash tools/backup_sensitive_files.sh
  # Esto crea sensitive_backup/ SOLO en tu m√°quina local
  ```

- **Nunca subas `sensitive_backup/` al repositorio** (ya est√° en `.gitignore`).
- Si necesitas restaurar tras una limpieza o p√©rdida accidental, copia los archivos desde `sensitive_backup/` a su ubicaci√≥n original.

## 4. Tabla Resumen ##

| Archivo/directorio           | ¬øSe sube a git? | ¬øSe debe crear tras clonar? | ¬øEs seguro para backup? |
|-----------------------------|:---------------:|:---------------------------:|:-----------------------:|
| `.env`                      | ‚ùå              | ‚úÖ (manual/copia ejemplo)    | Solo local/cifrado      |
| `sensitive_backup/`         | ‚ùå              | ‚ùå (solo local, nunca remoto)| Solo local/cifrado      |
| `.env.example`              | ‚úÖ              | ‚úÖ (para copiar estructura)  | S√≠, sin datos reales    |
| `config_debug.py`           | ‚ùå              | ‚úÖ (manual/copia ejemplo)    | Solo local/cifrado      |
| `config_debug_example.py`   | ‚úÖ              | ‚úÖ (estructura)              | S√≠, sin datos reales    |

## 5. Recomendaciones ##

- **Nunca subas archivos sensibles al repositorio**.
- Haz backups cifrados de tus archivos sensibles fuera del proyecto (gestor de contrase√±as, almacenamiento seguro, etc.).
- Si colaboras con otros, comparte solo los archivos de ejemplo y nunca los reales.
- Documenta cualquier archivo sensible nuevo que requiera el proyecto.

> ‚ö†Ô∏è **Recuerda:** Si subes accidentalmente un archivo sensible, **elim√≠nalo de la historia de git** y cambia inmediatamente las credenciales expuestas.

---

## üß≠ C√≥mo Generar y Mantener un √çndice Autom√°tico en Markdown ##

Un √≠ndice autom√°tico enlaza cada secci√≥n del documento con su t√≠tulo, facilitando la navegaci√≥n. Markdown puro no lo genera autom√°ticamente, pero existen herramientas y extensiones que lo hacen por ti.

**Herramientas √ötiles:**

- **VSCode:**
    - Extensi√≥n [Markdown All in One](https://marketplace.visualstudio.com/items?itemName=yzhang.markdown-all-in-one): genera y actualiza el √≠ndice (TOC) con un clic.
- **GitHub:**
    - Los enlaces internos funcionan usando el slug del t√≠tulo (min√∫sculas, sin tildes, espacios a guion, sin signos). Ejemplo: `# Mi secci√≥n especial` ‚Üí `#mi-seccion-especial`.
- **CLI:**
    - [doctoc](https://github.com/thlorenz/doctoc) o [markdown-toc](https://github.com/jonschlinkert/markdown-toc) generan √≠ndices desde terminal.

**Buenas Pr√°cticas:**

- Usa t√≠tulos √∫nicos y descriptivos.
- Mant√©n el √≠ndice actualizado tras a√±adir o mover secciones.
- Comprueba los enlaces tras cambios grandes.

**Ejemplo de Enlace Interno:**

```markdown
[Instalacion](#2-instalacion)
```

> üí° *Recuerda: los slugs de GitHub eliminan tildes y caracteres especiales, y convierten espacios en guiones.*
