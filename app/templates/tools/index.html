{% extends "admin/base.html" %} {% block content %}
<div class="row">
  <div class="col-md-3">
    <input
      type="text"
      class="form-control mb-3"
      id="script-search"
      placeholder="Buscar script..."
    />
    <div class="list-group" id="category-menu">
      {% for category in categories %}
      <a
        href="#cat-{{ category.id }}"
        class="list-group-item list-group-item-action"
        data-bs-toggle="tab"
        >{{ category.name }}</a
      >
      {% endfor %}
    </div>
  </div>
  <div class="col-md-9 tab-content" id="scripts-content">
    {% for category in categories %}
    <div class="tab-pane fade" id="cat-{{ category.id }}">
      <h4>{{ category.name }}</h4>
      <ul class="list-group">
        {% for script in category.scripts %}
        <li
          class="list-group-item d-flex flex-column flex-md-row align-items-md-center justify-content-between"
        >
          <div>
            <strong>{{ script.name }}</strong>
            <div class="text-muted small">{{ script.description }}</div>
          </div>
          <div>
            {% if script.executable %}
            <form
              method="post"
              action="{{ url_for('scripts.run_script', script_path=script.path) }}"
              style="display: inline"
            >
              <button type="submit" class="btn btn-primary btn-sm">
                Ejecutar
              </button>
            </form>
            {% else %}
            <span class="badge bg-secondary">No ejecutable</span>
            {% endif %}
            <a
              href="{{ url_for('scripts.view_script_content', script_path=script.path) }}"
              class="btn btn-outline-secondary btn-sm"
              >Ver código</a
            >
          </div>
        </li>
        {% endfor %}
      </ul>
    </div>
    {% endfor %}
  </div>
</div>
<script>
  // Búsqueda y filtrado dinámico de scripts
  document
    .getElementById("script-search")
    .addEventListener("input", function (e) {
      let value = e.target.value.toLowerCase();
      document
        .querySelectorAll(".list-group-item strong")
        .forEach(function (el) {
          let parent = el.closest(".list-group-item");
          parent.style.display = el.textContent.toLowerCase().includes(value)
            ? ""
            : "none";
        });
    });
</script>
{% endblock %}
