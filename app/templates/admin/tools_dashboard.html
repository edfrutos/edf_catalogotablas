{% extends 'admin/base.html' %} {% block title %}Gestor de Scripts y
Herramientas - Catálogo Tablas{% endblock %} {% block content %}
<div class="container mt-4">
  <div class="row mb-4">
    <div class="col-12">
      <div class="card shadow-sm">
        <div
          class="card-header bg-primary text-white d-flex align-items-center"
        >
          <i class="fas fa-tools me-2"></i>
          <h1 class="h3 mb-0">Gestor de Scripts y Herramientas</h1>
        </div>
        <div class="card-body">
          <div class="alert alert-info">
            <i class="fas fa-info-circle me-2"></i>
            <strong>Información:</strong> Esta herramienta permite visualizar y
            ejecutar los scripts y utilidades del sistema disponibles. Utilice
            con precaución, ya que algunos scripts pueden afectar la
            configuración del sistema.
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Navegación por pestañas -->
  <div class="row mb-4">
    <div class="col-12">
      <div class="card shadow-sm">
        <div class="card-body">
          <ul class="nav nav-tabs" id="toolsTabs" role="tablist">
            <li class="nav-item" role="presentation">
              <button
                class="nav-link active"
                id="local-tab"
                data-bs-toggle="tab"
                data-bs-target="#local"
                type="button"
                role="tab"
              >
                <i class="fas fa-laptop me-2"></i>Scripts Locales
              </button>
            </li>
            <li class="nav-item" role="presentation">
              <button
                class="nav-link"
                id="production-tab"
                data-bs-toggle="tab"
                data-bs-target="#production"
                type="button"
                role="tab"
              >
                <i class="fas fa-server me-2"></i>Scripts de Producción
              </button>
            </li>
          </ul>
        </div>
      </div>
    </div>
  </div>

  <!-- Contenido de las pestañas -->
  <div class="tab-content" id="toolsTabContent">
    <!-- Pestaña de Scripts Locales -->
    <div class="tab-pane fade show active" id="local" role="tabpanel">
      <div class="row mb-4">
        <div class="col-12">
          <div class="card shadow-sm">
            <div class="card-body">
              <div class="input-group mb-3">
                <span class="input-group-text"
                  ><i class="fas fa-search"></i
                ></span>
                <input
                  type="text"
                  id="searchInputLocal"
                  class="form-control"
                  placeholder="Buscar scripts locales por nombre o descripción..."
                />
              </div>
              <div
                class="btn-group mb-3 category-filter"
                id="categoryFilterContainerLocal"
              >
                <button
                  class="btn btn-outline-primary active"
                  data-category="all"
                >
                  Todos
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="row" id="scriptAccordionContainerLocal">
        <!-- Los scripts locales se cargarán dinámicamente aquí -->
      </div>
      <div class="row" id="noScriptsAlertLocal" style="display: none">
        <div class="col-12">
          <div class="alert alert-warning">
            <i class="fas fa-exclamation-triangle me-2"></i> No se encontraron scripts locales en el sistema.
          </div>
        </div>
      </div>
    </div>

    <!-- Pestaña de Scripts de Producción -->
    <div class="tab-pane fade" id="production" role="tabpanel">
      <div class="row mb-4">
        <div class="col-12">
          <div class="card shadow-sm">
            <div class="card-body">
              <div class="input-group mb-3">
                <span class="input-group-text"
                  ><i class="fas fa-search"></i
                ></span>
                <input
                  type="text"
                  id="searchInputProduction"
                  class="form-control"
                  placeholder="Buscar scripts de producción por nombre o descripción..."
                />
              </div>
              <div
                class="btn-group mb-3 category-filter"
                id="categoryFilterContainerProduction"
              >
                <button
                  class="btn btn-outline-primary active"
                  data-category="all"
                >
                  Todos
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="row" id="scriptAccordionContainerProduction">
        <!-- Los scripts de producción se cargarán dinámicamente aquí -->
      </div>
      <div class="row" id="noScriptsAlertProduction" style="display: none">
        <div class="col-12">
          <div class="alert alert-warning">
            <i class="fas fa-exclamation-triangle me-2"></i> No se encontraron scripts de producción en el sistema.
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Modal para ver el contenido del script -->
<div
  class="modal fade"
  id="scriptModal"
  tabindex="-1"
  aria-labelledby="scriptModalLabel"
  aria-hidden="true"
>
  <div class="modal-dialog modal-lg modal-dialog-scrollable">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="modalTitle">Contenido del Script</h5>
        <button
          type="button"
          class="btn-close"
          data-bs-dismiss="modal"
          aria-label="Close"
        ></button>
      </div>
      <div class="modal-body">
        <div class="script-path mb-3 text-muted small" id="modalPath"></div>

        <!-- Campo para comandos requeridos -->
        <div id="commandInputContainer" class="mb-3" style="display: none">
          <label for="commandInput" class="form-label">
            <i class="fas fa-terminal me-2"></i>Comando requerido:
          </label>
          <div class="input-group">
            <input
              type="text"
              class="form-control"
              id="commandInput"
              placeholder="Ingrese el comando requerido por el script..."
            />
            <button
              class="btn btn-outline-secondary"
              type="button"
              id="helpCommandBtn"
            >
              <i class="fas fa-question-circle"></i> Ayuda
            </button>
          </div>
          <div class="form-text">
            <i class="fas fa-info-circle me-1"></i>
            Algunos scripts requieren comandos adicionales para funcionar
            correctamente.
          </div>
        </div>

        <pre class="bg-light p-3 rounded" id="scriptContent"><code></code></pre>
        <div id="outputContainer" class="mt-4" style="display: none">
          <h6 class="border-bottom pb-2 mb-3">Salida del Script:</h6>
          <div class="d-flex align-items-center mb-2">
            <div
              id="runningIndicator"
              class="spinner-border spinner-border-sm text-primary me-2"
              role="status"
            >
              <span class="visually-hidden">Ejecutando...</span>
            </div>
            <div id="statusBadge" class="badge bg-secondary me-2">
              Esperando
            </div>
            <div id="timestampInfo" class="small text-muted"></div>
          </div>
          <pre class="bg-dark text-light p-3 rounded" id="scriptOutput"></pre>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
          Cerrar
        </button>
        <button
          type="button"
          class="btn btn-info"
          id="modalViewBtn"
          style="display: none"
        >
          <i class="fas fa-eye me-1"></i> Ver Código
        </button>
        <button type="button" class="btn btn-success" id="modalRunBtn">
          <i class="fas fa-play me-1"></i> Ejecutar Script
        </button>
      </div>
    </div>
  </div>
</div>
{% endblock %} {% block scripts %}
<script>
  document.addEventListener("DOMContentLoaded", function () {
    const scriptAccordionContainerLocal = document.getElementById(
      "scriptAccordionContainerLocal"
    );
    const searchInputLocal = document.getElementById("searchInputLocal");

    const scriptAccordionContainerProduction = document.getElementById(
      "scriptAccordionContainerProduction"
    );
    const searchInputProduction = document.getElementById("searchInputProduction");

    let scriptsData = { local: [], produccion: [] };
    let filteredDataLocal = [];
    let filteredDataProduction = [];

    // Función para cargar los scripts desde la API
    function loadScripts() {
      fetch("/admin/tools/api/scripts_metadata")
        .then((response) => response.json())
        .then((data) => {
          scriptsData = data || { local: [], produccion: [] };
          filteredDataLocal = [...scriptsData.local];
          filteredDataProduction = [...scriptsData.produccion];
          renderScripts();
          updateCategoryFilters();

          // Inicializar todas las pestañas
          initializeAllTabs();
        })
        .catch((error) => {
          console.error("Error cargando scripts:", error);
          document.getElementById("noScriptsAlertLocal").style.display = "block";
          document.getElementById("noScriptsAlertProduction").style.display = "block";
        });
    }

    // Función para inicializar todas las pestañas
    function initializeAllTabs() {
      // Pestaña de Scripts Locales (ya está inicializada) - Todas las categorías
      // Pestaña de Scripts de Producción - Todas las categorías
    }

    // Función para renderizar scripts
    function renderScripts() {
      // Renderizar scripts locales
      if (filteredDataLocal.length === 0) {
        document.getElementById("noScriptsAlertLocal").style.display = "block";
        scriptAccordionContainerLocal.innerHTML = "";
      } else {
        document.getElementById("noScriptsAlertLocal").style.display = "none";
        renderTabScripts(scriptAccordionContainerLocal, filteredDataLocal);
      }

      // Renderizar scripts de producción
      if (filteredDataProduction.length === 0) {
        document.getElementById("noScriptsAlertProduction").style.display = "block";
        scriptAccordionContainerProduction.innerHTML = "";
      } else {
        document.getElementById("noScriptsAlertProduction").style.display = "none";
        renderTabScripts(scriptAccordionContainerProduction, filteredDataProduction);
      }
    }

    // Función para renderizar scripts en una pestaña específica
    function renderTabScripts(container, scripts) {
      if (scripts.length === 0) {
        container.innerHTML =
          '<div class="col-12"><div class="alert alert-info">No hay scripts disponibles en esta categoría.</div></div>';
        return;
      }

      let html = "";
      let scriptIndex = 0;

      scripts.forEach((category) => {
        if (category.scripts && category.scripts.length > 0) {
          // Agregar título de categoría
          html += `
          <div class="col-12 mb-3">
            <h5 class="text-primary"><i class="fas fa-folder me-2"></i>${category.categoria}</h5>
          </div>
        `;

          // Agregar scripts de esta categoría
          category.scripts.forEach((script) => {
            html += `
            <div class="col-12 mb-3">
                <div class="card">
                    <div class="card-header" id="heading${scriptIndex}">
                        <div class="d-flex justify-content-between align-items-center">
                            <button class="btn btn-link text-decoration-none" type="button" data-bs-toggle="collapse" data-bs-target="#collapse${scriptIndex}">
                                <i class="fas fa-file-code me-2"></i>
                                <strong>${script.nombre}</strong>
                            </button>
                            <div class="btn-group">
                                <button class="btn btn-sm btn-outline-primary" onclick="viewScript('${script.path}')">
                                    <i class="fas fa-eye"></i> Ver
                                </button>
                                <button class="btn btn-sm btn-outline-success" onclick="runScript('${script.path}')">
                                    <i class="fas fa-play"></i> Ejecutar
                                </button>
                            </div>
                        </div>
                    </div>
                    <div id="collapse${scriptIndex}" class="collapse" data-bs-parent="#scriptAccordionContainer">
                        <div class="card-body">
                            <p><strong>Descripción:</strong> ${script.descripcion || "Sin descripción disponible"}</p>
                            <p><strong>Ruta:</strong> <code>${script.path}</code></p>
                            <p><strong>Tipo:</strong> <span class="badge bg-info">${script.tipo}</span></p>
                            <p><strong>Ejecutable:</strong> <span class="badge ${script.executable ? "bg-success" : "bg-warning"}">${script.executable ? "Sí" : "No"}</span></p>
                            <p><strong>Entorno:</strong> <span class="badge bg-secondary">${script.entorno || "N/A"}</span></p>
                        </div>
                    </div>
                </div>
            </div>
          `;
            scriptIndex++;
          });
        }
      });

      container.innerHTML = html;
    }

    // Función para actualizar los filtros de categorías
    function updateCategoryFilters() {
      // Actualizar filtros para scripts locales
      const categoriesLocal = scriptsData.local.map((category) => category.categoria);
      const containerLocal = document.getElementById("categoryFilterContainerLocal");
      createCategoryFilters(containerLocal, categoriesLocal, "local");

      // Actualizar filtros para scripts de producción
      const categoriesProduction = scriptsData.produccion.map((category) => category.categoria);
      const containerProduction = document.getElementById("categoryFilterContainerProduction");
      createCategoryFilters(containerProduction, categoriesProduction, "produccion");
    }

    // Función para crear filtros de categoría
    function createCategoryFilters(container, categories, entorno) {
      // Limpiar el contenedor
      container.innerHTML = "";

      // Crear el botón "Todos" con event listener
      const todosButton = document.createElement("button");
      todosButton.className = "btn btn-outline-primary active";
      todosButton.setAttribute("data-category", "all");
      todosButton.textContent = "Todos";
      todosButton.onclick = (event) => filterByCategory(entorno, "all", event);
      container.appendChild(todosButton);

      // Agregar botones para cada categoría
      categories.forEach((category) => {
        const button = document.createElement("button");
        button.className = "btn btn-outline-secondary";
        button.setAttribute("data-category", category);
        button.textContent = category;
        button.onclick = (event) => filterByCategory(entorno, category, event);
        container.appendChild(button);
      });
    }

    // Función para filtrar por categoría
    function filterByCategory(entorno, category, event) {
      // Actualizar botones activos
      const containerId = entorno === "local" ? "categoryFilterContainerLocal" : "categoryFilterContainerProduction";
      const container = document.getElementById(containerId);
      
      container.querySelectorAll(".btn").forEach((btn) => {
        btn.classList.remove("active");
        btn.classList.remove("btn-primary");
        btn.classList.add("btn-outline-secondary");
      });

      event.target.classList.add("active");
      event.target.classList.remove("btn-outline-secondary");
      event.target.classList.add("btn-primary");

      if (entorno === "local") {
        if (category === "all") {
          filteredDataLocal = [...scriptsData.local];
        } else {
          filteredDataLocal = scriptsData.local.filter((cat) => cat.categoria === category);
        }
        renderTabScripts(scriptAccordionContainerLocal, filteredDataLocal);
      } else {
        if (category === "all") {
          filteredDataProduction = [...scriptsData.produccion];
        } else {
          filteredDataProduction = scriptsData.produccion.filter((cat) => cat.categoria === category);
        }
        renderTabScripts(scriptAccordionContainerProduction, filteredDataProduction);
      }
    }

    // Función para buscar scripts locales
    searchInputLocal.addEventListener("input", function () {
      const searchTerm = this.value.toLowerCase();
      filteredDataLocal = scriptsData.local
        .map((category) => ({
          ...category,
          scripts: category.scripts.filter(
            (script) =>
              script.nombre.toLowerCase().includes(searchTerm) ||
              (script.descripcion &&
                script.descripcion.toLowerCase().includes(searchTerm))
          ),
        }))
        .filter((category) => category.scripts.length > 0);
      renderTabScripts(scriptAccordionContainerLocal, filteredDataLocal);
    });

    // Función para buscar scripts de producción
    searchInputProduction.addEventListener("input", function () {
      const searchTerm = this.value.toLowerCase();
      filteredDataProduction = scriptsData.produccion
        .map((category) => ({
          ...category,
          scripts: category.scripts.filter(
            (script) =>
              script.nombre.toLowerCase().includes(searchTerm) ||
              (script.descripcion &&
                script.descripcion.toLowerCase().includes(searchTerm))
          ),
        }))
        .filter((category) => category.scripts.length > 0);
      renderTabScripts(scriptAccordionContainerProduction, filteredDataProduction);
    });

    // Cargar scripts al inicializar
    loadScripts();

    // Configurar el botón "Ejecutar Script" del modal
    document
      .getElementById("modalRunBtn")
      .addEventListener("click", function () {
        if (currentScriptPath) {
          // Ocultar el contenido del script y mostrar la salida
          document.getElementById("scriptContent").style.display = "none";
          document.getElementById("outputContainer").style.display = "block";

          // Mostrar el botón "Ver Código" y ocultar el botón "Ejecutar Script"
          document.getElementById("modalViewBtn").style.display =
            "inline-block";
          document.getElementById("modalRunBtn").style.display = "none";

          // Ejecutar el script usando la función runScript
          runScriptFromModal(currentScriptPath);
        } else {
          alert("No hay script seleccionado para ejecutar");
        }
      });

    // Configurar el botón "Ver Código" del modal
    document
      .getElementById("modalViewBtn")
      .addEventListener("click", function () {
        // Mostrar el contenido del script y ocultar la salida
        document.getElementById("scriptContent").style.display = "block";
        document.getElementById("outputContainer").style.display = "none";

        // Ocultar el botón "Ver Código" y mostrar el botón "Ejecutar Script"
        document.getElementById("modalViewBtn").style.display = "none";
        document.getElementById("modalRunBtn").style.display = "inline-block";

        // Restaurar el título original
        document.getElementById("modalTitle").textContent =
          `Contenido: ${currentScriptPath.split("/").pop()}`;
      });

    // Configurar el botón de ayuda para comandos
    document
      .getElementById("helpCommandBtn")
      .addEventListener("click", function () {
        const scriptName = currentScriptPath.split("/").pop();
        let helpText = "";

        if (scriptName.toLowerCase().includes("backup")) {
          helpText =
            "Para scripts de backup, ingrese el directorio o archivo a respaldar.\nEjemplo: /ruta/al/directorio";
        } else if (scriptName.toLowerCase().includes("restore")) {
          helpText =
            "Para scripts de restore, ingrese la ruta del archivo de respaldo.\nEjemplo: backup_2024-01-01.tar.gz";
        } else if (scriptName.toLowerCase().includes("clean")) {
          helpText =
            "Para scripts de limpieza, ingrese el patrón de archivos a limpiar.\nEjemplo: *.tmp";
        } else if (scriptName.toLowerCase().includes("test")) {
          helpText =
            "Para scripts de prueba, ingrese los parámetros de prueba.\nEjemplo: --verbose --all";
        } else {
          helpText =
            "Revise el código del script para ver qué parámetros requiere.\nBusque palabras como 'input', 'sys.argv', 'argparse' en el código.";
        }

        alert(`Ayuda para ${scriptName}:\n\n${helpText}`);
      });
  });

  // Variable global para almacenar la ruta del script actual en el modal
  let currentScriptPath = "";

  // Función para detectar si un script requiere comandos
  function checkIfScriptRequiresCommand(content, path) {
    const scriptName = path.split("/").pop().toLowerCase();
    const contentLower = content.toLowerCase();

    // Lista de scripts que típicamente requieren comandos
    const scriptsRequiringCommands = [
      "backup",
      "restore",
      "migrate",
      "export",
      "import",
      "sync",
      "clean",
      "optimize",
      "analyze",
      "validate",
      "test",
    ];

    // Verificar por nombre del script
    for (const keyword of scriptsRequiringCommands) {
      if (scriptName.includes(keyword)) {
        return true;
      }
    }

    // Verificar por contenido del script
    const commandIndicators = [
      "input(",
      "raw_input(",
      "sys.argv",
      "argparse",
      "getopt",
      "require",
      "necesita",
      "comando",
      "parameter",
      "argument",
    ];

    for (const indicator of commandIndicators) {
      if (contentLower.includes(indicator)) {
        return true;
      }
    }

    return false;
  }

  // Funciones globales para scripts
  function viewScript(path) {
    // Almacenar la ruta del script actual
    currentScriptPath = path;

    fetch(`/admin/tools/content/${encodeURIComponent(path)}`)
      .then((response) => response.json())
      .then((data) => {
        if (data.error) {
          alert(`Error: ${data.error}`);
          return;
        }

        document.getElementById("modalTitle").textContent =
          `Contenido: ${data.name || path.split("/").pop()}`;
        document.getElementById("modalPath").textContent = data.path || path;
        document.getElementById("scriptContent").textContent = data.content;
        document.getElementById("scriptContent").style.display = "block";
        document.getElementById("outputContainer").style.display = "none";

        // Verificar si el script requiere comandos
        const requiresCommand = checkIfScriptRequiresCommand(
          data.content,
          path
        );
        const commandContainer = document.getElementById(
          "commandInputContainer"
        );
        if (requiresCommand) {
          commandContainer.style.display = "block";
          document.getElementById("commandInput").value = "";
        } else {
          commandContainer.style.display = "none";
        }

        // Resetear el estado de los botones
        document.getElementById("modalRunBtn").style.display = "inline-block";
        document.getElementById("modalViewBtn").style.display = "none";

        const modal = new bootstrap.Modal(
          document.getElementById("scriptModal")
        );
        modal.show();
      })
      .catch((error) => {
        console.error("Error cargando script:", error);
        alert("Error al cargar el contenido del script");
      });
  }

  function runScript(path) {
    if (
      !confirm(
        `¿Está seguro de que desea ejecutar el script "${path.split("/").pop()}"?`
      )
    ) {
      return;
    }

    const modal = document.getElementById("scriptModal");
    const modalTitle = document.getElementById("modalTitle");
    const modalPath = document.getElementById("modalPath");
    const outputContainer = document.getElementById("outputContainer");
    const runningIndicator = document.getElementById("runningIndicator");
    const statusBadge = document.getElementById("statusBadge");
    const scriptOutput = document.getElementById("scriptOutput");
    const timestampInfo = document.getElementById("timestampInfo");

    // Configurar el modal
    modalTitle.textContent = `Ejecutando: ${path.split("/").pop()}`;
    modalPath.textContent = path;
    outputContainer.style.display = "block";
    runningIndicator.style.display = "inline-block";
    statusBadge.textContent = "Ejecutando";
    statusBadge.className = "badge bg-warning me-2";
    scriptOutput.textContent = "Iniciando ejecución...";
    timestampInfo.textContent = new Date().toLocaleString();

    // Mostrar el modal
    const bootstrapModal = new bootstrap.Modal(modal);
    bootstrapModal.show();

    fetch(`/admin/tools/run/${encodeURIComponent(path)}`, {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
      },
    })
      .then((response) => response.json())
      .then((data) => {
        runningIndicator.style.display = "none";

        if (data.status === "success") {
          statusBadge.textContent = "Completado";
          statusBadge.className = "badge bg-success me-2";
          scriptOutput.textContent =
            data.stdout || "Script ejecutado correctamente";
        } else {
          statusBadge.textContent = "Error";
          statusBadge.className = "badge bg-danger me-2";
          scriptOutput.textContent =
            data.stderr || data.error || data.message || "Error desconocido";
        }
      })
      .catch((error) => {
        runningIndicator.style.display = "none";
        statusBadge.textContent = "Error";
        statusBadge.className = "badge bg-danger me-2";
        scriptOutput.textContent = `Error de conexión: ${error.message}`;
      });
  }

  // Función específica para ejecutar scripts desde el modal
  function runScriptFromModal(path) {
    // Verificar si se requiere un comando
    const commandInput = document.getElementById("commandInput");
    const commandContainer = document.getElementById("commandInputContainer");
    let command = "";

    if (commandContainer.style.display !== "none") {
      command = commandInput.value.trim();
      if (!command) {
        alert(
          "Este script requiere un comando. Por favor, ingrese el comando requerido."
        );
        commandInput.focus();
        return;
      }
    }

    if (
      !confirm(
        `¿Está seguro de que desea ejecutar el script "${path.split("/").pop()}"${command ? ` con el comando: ${command}` : ""}?`
      )
    ) {
      return;
    }

    const modalTitle = document.getElementById("modalTitle");
    const modalPath = document.getElementById("modalPath");
    const runningIndicator = document.getElementById("runningIndicator");
    const statusBadge = document.getElementById("statusBadge");
    const scriptOutput = document.getElementById("scriptOutput");
    const timestampInfo = document.getElementById("timestampInfo");

    // Configurar el modal para ejecución
    modalTitle.textContent = `Ejecutando: ${path.split("/").pop()}`;
    modalPath.textContent = path;
    runningIndicator.style.display = "inline-block";
    statusBadge.textContent = "Ejecutando";
    statusBadge.className = "badge bg-warning me-2";
    scriptOutput.textContent = "Iniciando ejecución...";
    timestampInfo.textContent = new Date().toLocaleString();

    fetch(`/admin/tools/run/${encodeURIComponent(path)}`, {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
      },
      body: JSON.stringify({
        command: command,
      }),
    })
      .then((response) => response.json())
      .then((data) => {
        runningIndicator.style.display = "none";

        if (data.status === "success") {
          statusBadge.textContent = "Completado";
          statusBadge.className = "badge bg-success me-2";
          scriptOutput.textContent =
            data.stdout || "Script ejecutado correctamente";
        } else {
          statusBadge.textContent = "Error";
          statusBadge.className = "badge bg-danger me-2";
          scriptOutput.textContent =
            data.stderr || data.error || data.message || "Error desconocido";
        }
      })
      .catch((error) => {
        runningIndicator.style.display = "none";
        statusBadge.textContent = "Error";
        statusBadge.className = "badge bg-danger me-2";
        scriptOutput.textContent = `Error de conexión: ${error.message}`;
      });
  }
</script>
{% endblock %}
