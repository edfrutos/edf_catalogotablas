{% extends 'admin/base.html' %} 
{% block title %}Gesti√≥n de Respaldo de Base de Datos{% endblock %} 

{% block head %}
<style>
  /* Estilos para el bot√≥n volver arriba */
  #backToTopBtn {
    transition: all 0.3s ease;
    opacity: 0.8;
  }
  
  #backToTopBtn:hover {
    opacity: 1;
    transform: translateY(-2px);
    box-shadow: 0 6px 12px rgba(0,0,0,0.4) !important;
  }
  
  /* Responsive para el bot√≥n */
  @media (max-width: 768px) {
    #backToTopBtn {
      bottom: 15px !important;
      right: 15px !important;
      width: 45px !important;
      height: 45px !important;
    }
  }
  
  /* Mejorar scroll de la tabla */
  .table-responsive {
    max-height: 70vh;
    overflow-y: auto;
  }
  
  /* Mantener el header de la tabla fijo */
  .table-responsive thead th {
    position: sticky;
    top: 0;
    background: white;
    z-index: 10;
  }
  
  /* Barra de paginaci√≥n flotante */
  .floating-pagination {
    position: fixed;
    bottom: 80px;
    left: 50%;
    transform: translateX(-50%);
    background: white;
    border: 1px solid #dee2e6;
    border-radius: 8px;
    padding: 10px 20px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    z-index: 999;
    display: none;
    min-width: 300px;
  }
  
  .floating-pagination.show {
    display: block !important;
  }
  
  /* Responsive para la paginaci√≥n flotante */
  @media (max-width: 768px) {
    .floating-pagination {
      bottom: 70px;
      left: 10px;
      right: 10px;
      transform: none;
      min-width: auto;
    }
  }
</style>
{% endblock %}

{% block content %}
<div class="container-fluid mt-4">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h2><i class="bi bi-database-check me-2"></i>Gesti√≥n de Respaldo</h2>
    <div>
      <a
        href="{{ url_for('admin.list_drive_backups') }}"
        class="btn btn-outline-primary me-2"
      >
        <i class="bi bi-google me-1"></i> Ver en Google Drive
      </a>
      <button
        onclick="window.location.reload()"
        class="btn btn-outline-secondary"
      >
        <i class="bi bi-arrow-repeat"></i> Actualizar
      </button>
    </div>
  </div>

  <!-- Tarjeta de resumen de Google Drive -->
  <div class="row mb-4">
    <div class="col-md-6">
      <div class="card border-left-primary shadow h-100 py-2">
        <div class="card-body">
          <div class="row no-gutters align-items-center">
            <div class="col mr-2">
              <div
                class="text-xs font-weight-bold text-primary text-uppercase mb-1"
              >
                Respaldo en Google Drive
              </div>
              <div class="h5 mb-0 font-weight-bold text-gray-800">
                {{ drive_backups_count }} respaldos almacenados
              </div>
            </div>
            <div class="col-auto">
              <i class="bi bi-google fa-2x text-gray-300"></i>
            </div>
          </div>
          <div class="mt-2">
            <a href="{{ url_for('admin.list_drive_backups') }}" class="text-xs">
              Ver todos los respaldos <i class="bi bi-arrow-right"></i>
            </a>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Panel de acciones -->
  <div class="row mb-4">
    <div class="col-md-12">
      <div class="card border-0 shadow-sm">
        <div class="card-header bg-primary text-white">
          <i class="bi bi-database-down me-2"></i>Crear Respaldo Local
        </div>
        <div class="card-body">
          <div class="row align-items-center">
            <div class="col-md-8">
              <p class="mb-0">
                Crea un nuevo respaldo local completo de la base de datos en el
                directorio <code>backups/</code>. Se recomienda realizar esta
                acci√≥n antes de actualizaciones importantes.
              </p>
            </div>
            <div class="col-md-4 text-end">
              <button
                id="createBackupBtn"
                type="button"
                class="btn btn-primary"
              >
                <i class="bi bi-download me-2"></i>Crear Respaldo Local
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Lista de respaldos locales -->
  <div class="row">
    <div class="col-12">
      <div class="card border-0 shadow-sm">
        <div
          class="card-header bg-white d-flex justify-content-between align-items-center"
        >
          <h5 class="mb-0"><i class="bi bi-hdd me-2"></i>Respaldos Locales</h5>
          <span class="badge bg-primary rounded-pill"
            >{{ total_backups }} respaldos</span
          >
        </div>
        <div class="card-body p-0">
          {% if backups %}
          <div class="table-responsive">
            <table class="table table-hover mb-0">
              <thead class="table-light">
                <tr>
                  <th>Nombre del Archivo</th>
                  <th>Tama√±o</th>
                  <th>Fecha de Creaci√≥n</th>
                  <th>Estado</th>
                  <th class="text-end">Acciones</th>
                </tr>
              </thead>
              <tbody>
                {% for backup in backups %}
                <tr>
                  <td class="align-middle">
                    <i
                      class="bi bi-file-earmark-zip-fill text-primary me-2"
                    ></i>
                    {{ backup.name }}
                  </td>
                  <td class="align-middle">
                    {{ backup.size }}
                  </td>
                  <td class="align-middle">
                    {{ backup.modified }}
                  </td>
                  <td class="align-middle">
                    {% if backup.name.startswith('backup_') %}
                    <span class="badge bg-success">JSON</span>
                    {% else %}
                    <span class="badge bg-warning">Otro</span>
                    {% endif %}
                  </td>
                  <td class="text-end">
                    <div class="btn-group" role="group">
                      <a
                        href="{{ url_for('admin.download_backup', filename=backup.name) }}"
                        class="btn btn-sm btn-outline-primary"
                        title="Descargar"
                      >
                        <i class="bi bi-download"></i>
                      </a>
                      {% if backup.name.startswith('backup_') %}
                      <button
                        type="button"
                        class="btn btn-sm btn-outline-warning"
                        onclick="restoreLocalBackup('{{ backup.name }}')"
                        title="Restaurar desde este backup"
                      >
                        <i class="bi bi-arrow-counterclockwise"></i>
                      </button>
                      {% else %}
                      <button
                        type="button"
                        class="btn btn-sm btn-outline-secondary"
                        disabled
                        title="Solo se pueden restaurar backups JSON"
                      >
                        <i class="bi bi-arrow-counterclockwise"></i>
                      </button>
                      {% endif %}
                      <button
                        type="button"
                        class="btn btn-sm btn-outline-success"
                        onclick="uploadToDrive('{{ backup.name }}')"
                        title="Subir a Google Drive"
                      >
                        <i class="bi bi-cloud-upload"></i>
                      </button>
                      <button
                        type="button"
                        class="btn btn-sm btn-outline-danger"
                        data-bs-toggle="modal"
                        data-bs-target="#deleteBackupModal"
                        data-backup="{{ backup.name }}"
                        title="Eliminar local"
                      >
                        <i class="bi bi-trash"></i>
                      </button>
                    </div>
                  </td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
          {% else %}
          <div class="text-center p-5">
            <i class="bi bi-inbox text-muted" style="font-size: 3rem"></i>
            <p class="mt-3 mb-0 text-muted">No hay respaldos disponibles</p>
          </div>
          {% endif %}
        </div>
        {% if backups and total_pages > 1 %}
        <div class="card-footer bg-white">
          <div class="row align-items-center">
            <div class="col-md-6">
              <small class="text-muted">
                Mostrando {{ backups|length }} de {{ total_backups }} respaldos 
                (p√°gina {{ page }} de {{ total_pages }})
              </small>
            </div>
            <div class="col-md-6">
              <div class="d-flex justify-content-between align-items-center">
                <!-- Selector de elementos por p√°gina -->
                <div class="d-flex align-items-center">
                  <label for="perPageSelect" class="form-label me-2 mb-0">Mostrar:</label>
                  <select id="perPageSelect" class="form-select form-select-sm" style="width: auto;">
                    <option value="5" {% if per_page == 5 %}selected{% endif %}>5</option>
                    <option value="10" {% if per_page == 10 %}selected{% endif %}>10</option>
                    <option value="20" {% if per_page == 20 %}selected{% endif %}>20</option>
                    <option value="50" {% if per_page == 50 %}selected{% endif %}>50</option>
                  </select>
                </div>
                
                <!-- Navegaci√≥n de p√°ginas -->
                <nav aria-label="Navegaci√≥n de p√°ginas">
                  <ul class="pagination pagination-sm mb-0">
                    <!-- Bot√≥n Anterior -->
                    <li class="page-item {% if page == 1 %}disabled{% endif %}">
                      <a class="page-link" href="{{ url_for('admin.db_backup', page=page-1, per_page=per_page) if page > 1 else '#' }}">
                        <i class="bi bi-chevron-left"></i>
                      </a>
                    </li>
                    
                    <!-- N√∫meros de p√°gina -->
                    {% for p in range(1, total_pages + 1) %}
                      {% if p == 1 or p == total_pages or (p >= page - 2 and p <= page + 2) %}
                        <li class="page-item {% if p == page %}active{% endif %}">
                          <a class="page-link" href="{{ url_for('admin.db_backup', page=p, per_page=per_page) }}">{{ p }}</a>
                        </li>
                      {% elif p == page - 3 or p == page + 3 %}
                        <li class="page-item disabled">
                          <span class="page-link">...</span>
                        </li>
                      {% endif %}
                    {% endfor %}
                    
                    <!-- Bot√≥n Siguiente -->
                    <li class="page-item {% if page == total_pages %}disabled{% endif %}">
                      <a class="page-link" href="{{ url_for('admin.db_backup', page=page+1, per_page=per_page) if page < total_pages else '#' }}">
                        <i class="bi bi-chevron-right"></i>
                      </a>
                    </li>
                  </ul>
                </nav>
              </div>
            </div>
          </div>
        </div>
        {% endif %}
      </div>
    </div>
  </div>
</div>

<!-- Barra de paginaci√≥n flotante -->
{% if backups and total_pages > 1 %}
<div id="floatingPagination" class="floating-pagination" style="position: fixed; bottom: 80px; left: 50%; transform: translateX(-50%); background: white; border: 1px solid #dee2e6; border-radius: 8px; padding: 10px 20px; box-shadow: 0 4px 12px rgba(0,0,0,0.15); z-index: 999; min-width: 300px;">
  <div class="d-flex justify-content-between align-items-center">
    <div class="d-flex align-items-center">
      <small class="text-muted me-3">
        Mostrando {{ backups|length }} de {{ total_backups }} respaldos 
        (p√°gina {{ page }} de {{ total_pages }})
      </small>
    </div>
    <div class="d-flex align-items-center">
      <!-- Selector de elementos por p√°gina -->
      <div class="d-flex align-items-center me-3">
        <label for="perPageSelectFloating" class="form-label me-2 mb-0">Mostrar:</label>
        <select id="perPageSelectFloating" class="form-select form-select-sm" style="width: auto;">
          <option value="5" {% if per_page == 5 %}selected{% endif %}>5</option>
          <option value="10" {% if per_page == 10 %}selected{% endif %}>10</option>
          <option value="20" {% if per_page == 20 %}selected{% endif %}>20</option>
          <option value="50" {% if per_page == 50 %}selected{% endif %}>50</option>
        </select>
      </div>
      
      <!-- Navegaci√≥n de p√°ginas -->
      <nav aria-label="Navegaci√≥n de p√°ginas">
        <ul class="pagination pagination-sm mb-0">
          <!-- Bot√≥n Anterior -->
          <li class="page-item {% if page == 1 %}disabled{% endif %}">
            <a class="page-link" href="{{ url_for('admin.db_backup', page=page-1, per_page=per_page) if page > 1 else '#' }}">
              <i class="bi bi-chevron-left"></i>
            </a>
          </li>
          
          <!-- N√∫meros de p√°gina -->
          {% for p in range(1, total_pages + 1) %}
            {% if p == 1 or p == total_pages or (p >= page - 2 and p <= page + 2) %}
              <li class="page-item {% if p == page %}active{% endif %}">
                <a class="page-link" href="{{ url_for('admin.db_backup', page=p, per_page=per_page) }}">{{ p }}</a>
              </li>
            {% elif p == page - 3 or p == page + 3 %}
              <li class="page-item disabled">
                <span class="page-link">...</span>
              </li>
            {% endif %}
          {% endfor %}
          
          <!-- Bot√≥n Siguiente -->
          <li class="page-item {% if page == total_pages %}disabled{% endif %}">
            <a class="page-link" href="{{ url_for('admin.db_backup', page=page+1, per_page=per_page) if page < total_pages else '#' }}">
              <i class="bi bi-chevron-right"></i>
            </a>
          </li>
        </ul>
      </nav>
    </div>
  </div>
</div>
{% endif %}

<!-- Bot√≥n Volver Arriba -->
<button id="backToTopBtn" class="btn btn-primary position-fixed" 
        style="bottom: 20px; right: 20px; z-index: 1000; display: none; border-radius: 50%; width: 50px; height: 50px; box-shadow: 0 4px 8px rgba(0,0,0,0.3);"
        title="Volver arriba">
  <i class="bi bi-arrow-up"></i>
</button>

<!-- Modal de confirmaci√≥n para eliminar respaldo -->
<div class="modal fade" id="deleteBackupModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Confirmar Eliminaci√≥n</h5>
        <button
          type="button"
          class="btn-close"
          data-bs-dismiss="modal"
          aria-label="Cerrar"
        ></button>
      </div>
      <div class="modal-body">
        <p>
          ¬øEst√°s seguro de que deseas eliminar el respaldo
          <strong id="backupToDelete"></strong>?
        </p>
        <p class="text-danger">
          <i class="bi bi-exclamation-triangle-fill me-2"></i>Esta acci√≥n no se
          puede deshacer.
        </p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
          Cancelar
        </button>
        <button
          type="button"
          class="btn btn-danger"
          onclick="deleteLocalBackup()"
        >
          <i class="bi bi-trash me-2"></i>Eliminar
        </button>
      </div>
    </div>
  </div>
</div>
{% endblock %} {% block scripts %}
<script>
  // Funci√≥n simple para crear backup
  // Funci√≥n para mostrar notificaciones emergentes
  function showNotification(title, message, type = "info", duration = 5000) {
    // Crear el modal de notificaci√≥n
    const modalHtml = `
      <div class="modal fade" id="notificationModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
          <div class="modal-content">
            <div class="modal-header ${type === "success" ? "bg-success text-white" : type === "error" ? "bg-danger text-white" : "bg-info text-white"}">
              <h5 class="modal-title">
                ${type === "success" ? "‚úÖ" : type === "error" ? "‚ùå" : "‚ÑπÔ∏è"} ${title}
              </h5>
              <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
              <p class="mb-0">${message}</p>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
            </div>
          </div>
        </div>
      </div>
    `;

    // Remover modal anterior si existe
    const existingModal = document.getElementById("notificationModal");
    if (existingModal) {
      existingModal.remove();
    }

    // Agregar nuevo modal al body
    document.body.insertAdjacentHTML("beforeend", modalHtml);

    // Mostrar modal
    const modal = new bootstrap.Modal(
      document.getElementById("notificationModal")
    );
    modal.show();

    // Auto-cerrar despu√©s del tiempo especificado
    if (duration > 0) {
      setTimeout(() => {
        modal.hide();
      }, duration);
    }
  }

  // Funci√≥n para mostrar progreso
  function showProgress(title, message) {
    const progressHtml = `
      <div class="modal fade" id="progressModal" tabindex="-1" aria-hidden="true" data-bs-backdrop="static" data-bs-keyboard="false">
        <div class="modal-dialog modal-dialog-centered">
          <div class="modal-content">
            <div class="modal-header bg-primary text-white">
              <h5 class="modal-title">üîÑ ${title}</h5>
            </div>
            <div class="modal-body text-center">
              <div class="spinner-border text-primary mb-3" role="status">
                <span class="visually-hidden">Procesando...</span>
              </div>
              <p class="mb-0">${message}</p>
            </div>
          </div>
        </div>
      </div>
    `;

    // Remover modal anterior si existe
    const existingModal = document.getElementById("progressModal");
    if (existingModal) {
      existingModal.remove();
    }

    // Agregar nuevo modal al body
    document.body.insertAdjacentHTML("beforeend", progressHtml);

    // Mostrar modal
    const modal = new bootstrap.Modal(document.getElementById("progressModal"));
    modal.show();
    return modal;
  }

  function createLocalBackup() {
    const button = document.getElementById("createBackupBtn");
    if (!button) {
      showNotification("Error", "No se encontr√≥ el bot√≥n de backup", "error");
      return;
    }

    // Deshabilitar bot√≥n
    button.disabled = true;
    button.innerHTML =
      '<span class="spinner-border spinner-border-sm me-2"></span>Creando respaldo...';

    // Mostrar progreso
    const progressModal = showProgress(
      "Creando Respaldo Local",
      "Generando backup de la base de datos..."
    );

    // Realizar petici√≥n POST
    fetch("/admin/db/backup", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
        "X-Requested-With": "XMLHttpRequest",
      },
      credentials: "same-origin",
    })
      .then((response) => {
        console.log("Response status:", response.status);
        console.log("Response headers:", response.headers);

        if (!response.ok) {
          throw new Error(`HTTP ${response.status}: ${response.statusText}`);
        }

        return response.json();
      })
      .then((data) => {
        console.log("Response data:", data);
        progressModal.hide();

        if (data.status === "success") {
          showNotification(
            "√âxito",
            "‚úÖ Respaldo local creado exitosamente!",
            "success"
          );
          setTimeout(() => window.location.reload(), 2000);
        } else {
          throw new Error(data.message || "Error desconocido");
        }
      })
      .catch((error) => {
        console.error("Error:", error);
        progressModal.hide();
        showNotification(
          "Error",
          "‚ùå Error al crear respaldo: " + error.message,
          "error"
        );
      })
      .finally(() => {
        // Restaurar bot√≥n
        button.disabled = false;
        button.innerHTML =
          '<i class="bi bi-download me-2"></i>Crear Respaldo Local';
      });
  }

  // Variable global para almacenar el archivo a eliminar
  let backupToDelete = null;

  // Configurar modal de eliminaci√≥n
  document.addEventListener("DOMContentLoaded", function () {
    const backupBtn = document.getElementById("createBackupBtn");
    if (backupBtn) {
      backupBtn.addEventListener("click", createLocalBackup);
    }

    // Configurar modal de eliminaci√≥n
    const deleteModal = document.getElementById("deleteBackupModal");
    if (deleteModal) {
      deleteModal.addEventListener("show.bs.modal", function (event) {
        const button = event.relatedTarget;
        const backup = button.getAttribute("data-backup");
        backupToDelete = backup;

        const backupNameElement = document.getElementById("backupToDelete");
        if (backupNameElement) {
          backupNameElement.textContent = backup;
        }
      });
    }
  });

  // Funci√≥n para restaurar backup
  function restoreLocalBackup(filename) {
    if (!confirm("¬øRestaurar desde " + filename + "?")) {
      return;
    }

    // Mostrar progreso
    const progressModal = showProgress(
      "Restaurando Backup",
      "Restaurando datos desde " + filename + "..."
    );

    fetch("/admin/restore-local-backup", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
        "X-Requested-With": "XMLHttpRequest",
      },
      credentials: "same-origin",
      body: JSON.stringify({ filename: filename }),
    })
      .then((response) => response.json())
      .then((data) => {
        progressModal.hide();

        if (data.success) {
          showNotification(
            "√âxito",
            "‚úÖ Backup restaurado exitosamente!",
            "success"
          );
          setTimeout(() => window.location.reload(), 2000);
        } else {
          throw new Error(data.error || "Error desconocido");
        }
      })
      .catch((error) => {
        console.error("Error:", error);
        progressModal.hide();
        showNotification(
          "Error",
          "‚ùå Error al restaurar: " + error.message,
          "error"
        );
      });
  }

  // Funci√≥n para subir a Google Drive
  function uploadToDrive(filename) {
    if (!confirm("¬øSubir " + filename + " a Google Drive?")) {
      return;
    }

    // Mostrar progreso
    const progressModal = showProgress(
      "Subiendo a Google Drive",
      "Subiendo " + filename + " a Google Drive..."
    );

    fetch("/admin/backup/upload-to-drive/" + encodeURIComponent(filename), {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
        "X-Requested-With": "XMLHttpRequest",
      },
      credentials: "same-origin",
    })
      .then((response) => response.json())
      .then((data) => {
        progressModal.hide();

        if (data.success) {
          showNotification(
            "√âxito",
            "‚úÖ Backup subido a Google Drive exitosamente!",
            "success"
          );
          setTimeout(() => window.location.reload(), 2000);
        } else {
          throw new Error(data.error || "Error desconocido");
        }
      })
      .catch((error) => {
        console.error("Error:", error);
        progressModal.hide();
        showNotification(
          "Error",
          "‚ùå Error al subir a Google Drive: " + error.message,
          "error"
        );
      });
  }

  // Funci√≥n para eliminar backup local
  function deleteLocalBackup() {
    if (!backupToDelete) {
      showNotification("Error", "No se especific√≥ archivo a eliminar", "error");
      return;
    }

    // Cerrar modal
    const modal = bootstrap.Modal.getInstance(
      document.getElementById("deleteBackupModal")
    );
    if (modal) {
      modal.hide();
    }

    // Mostrar progreso
    const progressModal = showProgress(
      "Eliminando Backup",
      "Eliminando " + backupToDelete + "..."
    );

    fetch("/admin/backup/delete-local/" + encodeURIComponent(backupToDelete), {
      method: "DELETE",
      headers: {
        "Content-Type": "application/json",
        "X-Requested-With": "XMLHttpRequest",
      },
      credentials: "same-origin",
    })
      .then((response) => response.json())
      .then((data) => {
        progressModal.hide();

        if (data.success) {
          showNotification(
            "√âxito",
            "‚úÖ Backup eliminado exitosamente!",
            "success"
          );
          setTimeout(() => window.location.reload(), 2000);
        } else {
          throw new Error(data.error || "Error desconocido");
        }
      })
      .catch((error) => {
        console.error("Error:", error);
        progressModal.hide();
        showNotification(
          "Error",
          "‚ùå Error al eliminar backup: " + error.message,
          "error"
        );
      });
  }

  // Funci√≥n para manejar el cambio en el selector de elementos por p√°gina
  document.addEventListener('DOMContentLoaded', function() {
    const perPageSelect = document.getElementById('perPageSelect');
    const perPageSelectFloating = document.getElementById('perPageSelectFloating');
    const floatingPagination = document.getElementById('floatingPagination');
    const backToTopBtn = document.getElementById('backToTopBtn');
    
    // Funci√≥n para cambiar elementos por p√°gina
    function handlePerPageChange(selectElement) {
      if (selectElement) {
        selectElement.addEventListener('change', function() {
          const newPerPage = this.value;
          const currentUrl = new URL(window.location);
          currentUrl.searchParams.set('per_page', newPerPage);
          currentUrl.searchParams.set('page', '1'); // Volver a la primera p√°gina
          window.location.href = currentUrl.toString();
        });
      }
    }
    
    // Configurar ambos selectores
    handlePerPageChange(perPageSelect);
    handlePerPageChange(perPageSelectFloating);
    
    // Sincronizar los selectores
    if (perPageSelect && perPageSelectFloating) {
      perPageSelect.addEventListener('change', function() {
        perPageSelectFloating.value = this.value;
      });
      perPageSelectFloating.addEventListener('change', function() {
        perPageSelect.value = this.value;
      });
    }
    
    // Funcionalidad del bot√≥n "Volver arriba"
    const backToTopBtn = document.getElementById('backToTopBtn');
    
    // Mostrar/ocultar bot√≥n y paginaci√≥n flotante seg√∫n el scroll
    window.addEventListener('scroll', function() {
      const scrollY = window.pageYOffset;
      
      // Mostrar bot√≥n volver arriba despu√©s de 300px
      if (scrollY > 300) {
        backToTopBtn.style.display = 'block';
      } else {
        backToTopBtn.style.display = 'none';
      }
      
      // Mostrar paginaci√≥n flotante cuando la paginaci√≥n original no es visible
      if (floatingPagination) {
        const originalPagination = document.querySelector('.card-footer');
        if (originalPagination) {
          const originalPaginationRect = originalPagination.getBoundingClientRect();
          const isOriginalPaginationVisible = originalPaginationRect.top < window.innerHeight && originalPaginationRect.bottom > 0;
          
          if (!isOriginalPaginationVisible && scrollY > 200) {
            floatingPagination.classList.add('show');
          } else {
            floatingPagination.classList.remove('show');
          }
        }
      }
    });
    
    // Funci√≥n para volver arriba con animaci√≥n suave
    backToTopBtn.addEventListener('click', function() {
      window.scrollTo({
        top: 0,
        behavior: 'smooth'
      });
    });
    
    // Mostrar bot√≥n si hay muchos elementos (m√°s de 10 filas)
    const tableRows = document.querySelectorAll('tbody tr');
    if (tableRows.length > 10) {
      backToTopBtn.style.display = 'block';
    }
    
    // Verificar si la paginaci√≥n flotante debe mostrarse inicialmente
    const tableRows = document.querySelectorAll('tbody tr');
    
    if (floatingPagination && tableRows.length > 15) {
      floatingPagination.style.display = 'block';
    }
    
    // Mostrar bot√≥n si hay muchos elementos (m√°s de 10 filas)
    if (tableRows.length > 10) {
      backToTopBtn.style.display = 'block';
    }
  });
</script>
{% endblock %}
